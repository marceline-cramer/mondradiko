// Copyright (c) 2020-2021 the Mondradiko contributors.
// SPDX-License-Identifier: LGPL-3.0-or-later

#pragma once

#include "lib/include/vulkan_headers.h"

namespace mondradiko {
namespace core {

// Forward declarations
class GpuBuffer;
class GpuInstance;

class GpuImage {
 public:
  GpuImage(GpuInstance*, VkFormat, uint32_t, uint32_t, uint32_t,
           VkImageUsageFlags, VmaMemoryUsage);
  ~GpuImage();

  void transitionLayout(VkImageLayout);

  void updateLayout(VkImageLayout new_layout) { layout = new_layout; }
  VkImageLayout getLayout() const { return layout; }
  VkImage getImage() const { return image; }
  VkImageView getView() const { return view; }
  uint32_t getWidth() const { return width; }
  uint32_t getHeight() const { return height; }
  size_t getSize() const { return allocation_info.size; }

 private:
  GpuInstance* gpu;

  VkFormat format;
  VkImageLayout layout;
  uint32_t width;
  uint32_t height;
  uint32_t level_num;
  VmaAllocation allocation = nullptr;
  VmaAllocationInfo allocation_info;
  VkImage image = VK_NULL_HANDLE;
  VkImageView view = VK_NULL_HANDLE;

  void createView();
};

}  // namespace core
}  // namespace mondradiko
